<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<title>Timeline Soutenance</title>

<style>
body {
  font-family: system-ui, sans-serif;
  background: #0f0f0f;
  color: #eee;
  padding: 30px;
}

h1 { text-align: center; }

#globalTime {
  text-align: center;
  font-size: 2.3em;
  margin-bottom: 20px;
}

.timeline {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 10px;
  margin-bottom: 25px;
}

.block {
  padding: 14px;
  border-radius: 10px;
  text-align: center;
  background: #222;
  opacity: 0.4;
}

.block.active {
  background: #1f6feb;
  opacity: 1;
  transform: scale(1.05);
}

.block.next {
  background: #2ea043;
  opacity: 0.7;
}

.block.done {
  background: #444;
  opacity: 0.25;
}

.title { font-weight: bold; }
.time { font-size: 0.85em; opacity: 0.8; }

.progress-container {
  background: #222;
  border-radius: 8px;
  height: 14px;
  overflow: hidden;
  margin-bottom: 15px;
}

.progress-bar {
  height: 100%;
  background: #1f6feb;
  width: 0%;
}

#sectionTime {
  text-align: center;
  font-size: 1.6em;
  margin-bottom: 20px;
}

.controls {
  display: flex;
  justify-content: center;
  gap: 15px;
}

button {
  padding: 12px 20px;
  font-size: 1em;
  cursor: pointer;
}
</style>
</head>

<body>

<h1>Timeline Soutenance</h1>

<div id="globalTime">00:00</div>

<div class="timeline" id="timeline"></div>

<div class="progress-container">
  <div class="progress-bar" id="progress"></div>
</div>

<div id="sectionTime">Prêt</div>

<div class="controls">
  <button onclick="start()">Lancer</button>
  <button onclick="skipSection()">Section suivante</button>
  <button onclick="iAmLate()">Je suis en retard</button>
</div>

<script>
/* ================= CONFIG ================= */

let schedule = [
  { name: "Intro", duration: 120 },
  { name: "Théorie", duration: 240 },
  { name: "Méthodo", duration: 390 },
  { name: "Résultats", duration: 480 },
  { name: "Takeaways", duration: 120 },
  { name: "Conclusion", duration: 180 },
  { name: "Buffer", duration: 60 }
];

const timeline = document.getElementById("timeline");

/* ================= UI ================= */

function renderTimeline() {
  timeline.innerHTML = "";
  schedule.forEach(section => {
    const block = document.createElement("div");
    block.className = "block";
    block.innerHTML = `
      <div class="title">${section.name}</div>
      <div class="time">${Math.round(section.duration / 60)} min</div>
    `;
    timeline.appendChild(block);
  });
}

renderTimeline();

/* ================= TIMER ================= */

let current = 0;
let sectionRemaining = 0;
let globalElapsed = 0;
let timer = null;

function format(sec) {
  const m = String(Math.floor(sec / 60)).padStart(2, "0");
  const s = String(sec % 60).padStart(2, "0");
  return `${m}:${s}`;
}

function updateTimeline() {
  [...timeline.children].forEach((block, i) => {
    block.classList.remove("active", "next", "done");
    if (i < current) block.classList.add("done");
    else if (i === current) block.classList.add("active");
    else if (i === current + 1) block.classList.add("next");
  });
}

function startSection() {
  sectionRemaining = schedule[current].duration;
  updateTimeline();
}

/* ===== AVANCE ===== */

function skipSection() {
  const leftover = sectionRemaining;
  const remaining = schedule.length - current - 1;

  if (remaining > 0) {
    const bonus = Math.floor(leftover / remaining);
    for (let i = current + 1; i < schedule.length; i++) {
      schedule[i].duration += bonus;
    }
  }

  current++;
  if (current < schedule.length) {
    startSection();
    renderTimeline();
  }
}

/* ===== RETARD ===== */

function iAmLate() {
  const remainingSections = schedule.slice(current);
  const remainingTime = remainingSections.reduce((a, b) => a + b.duration, 0);

  const compressionRatio = 0.85; // 15 % de compression douce

  remainingSections.forEach(section => {
    section.duration = Math.max(30, Math.floor(section.duration * compressionRatio));
  });

  sectionRemaining = Math.min(sectionRemaining, schedule[current].duration);
  renderTimeline();
  updateTimeline();
}

/* ===== START ===== */

function start() {
  if (timer) clearInterval(timer);

  current = 0;
  globalElapsed = 0;
  startSection();

  timer = setInterval(() => {
    sectionRemaining--;
    globalElapsed++;

    document.getElementById("sectionTime").textContent =
      `${schedule[current].name} – ${format(sectionRemaining)}`;

    const total = schedule.reduce((a, b) => a + b.duration, 0);
    document.getElementById("globalTime").textContent =
      `Temps : ${format(globalElapsed)} / ${format(total)}`;

    document.getElementById("progress").style.width =
      `${(globalElapsed / total) * 100}%`;

    if (sectionRemaining <= 0) {
      current++;
      if (current < schedule.length) {
        startSection();
        renderTimeline();
      } else {
        clearInterval(timer);
        document.getElementById("sectionTime").textContent = "Terminé";
      }
    }
  }, 1000);
}
</script>

</body>
</html>
